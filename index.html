<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>learnmore万博クイズ</title>
<link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet"> 
<style>
  body { font-family: 'Kosugi Maru', sans-serif; text-align: center; background: #f0f0f0; }
  #quizContainer, #nameInput, #certificate { margin: 20px auto; width: 800px; background: #fff; padding: 20px; border-radius: 8px; }
  button { margin: 5px; padding: 8px 12px; }
  img.quizImg { max-width: 400px; display: block; margin: 10px auto; }
  .iconOption { width: 80px; height: 80px; border: 2px solid #ccc; margin: 5px; cursor: pointer; }
  .selected { border-color: #007BFF; }
  .choiceBtn.selected { background-color: #007BFF; color: #fff; }
  .choiceBtn.disabled { opacity: 0.5; pointer-events: none; }
</style>
</head>
<body>

<div id="quizContainer">
  <h2 id="questionNumber">問題①</h2>
  <p id="questionText"></p>
  <img id="questionImg" class="quizImg" style="display:none;">
  <div id="choices"></div>
  <button id="confirmBtn" onclick="confirmAnswer()" disabled>回答</button>
  <div>
    <button id="prevBtn" onclick="prevQuestion()">← 前の問題</button>
    <button id="nextBtn" onclick="nextQuestion()">次の問題 →</button>
  </div>
  <p id="quizResult"></p>
</div>

<div id="nameInput" style="display:none;">
  <h2 id="nameInputTitle">賞状を作成できます</h2>
  <p>名前を入力してください：</p>
  <input type="text" id="userNameField" placeholder="名前を入力"><br><br>
  <p>アイコンを選択：</p>
  <div id="iconSelection">
    <div>
      <img src="images/icon1.PNG" class="iconOption" onclick="selectIcon(this)">
      <img src="images/icon2.png" class="iconOption" onclick="selectIcon(this)">
      <img src="images/icon3.png" class="iconOption" onclick="selectIcon(this)">
      <img src="images/icon4.png" class="iconOption" onclick="selectIcon(this)">
      <img src="images/icon5.png" class="iconOption" onclick="selectIcon(this)">
    </div>
    <div>
      <img src="images/icon6.png" class="iconOption" onclick="selectIcon(this)">
      <img src="images/icon7.png" class="iconOption" onclick="selectIcon(this)">
      <img src="images/icon8.png" class="iconOption" onclick="selectIcon(this)">
      <img src="images/icon9.png" class="iconOption" onclick="selectIcon(this)">
    </div>
  </div><br>
  <button onclick="generateCertificate()">賞状を表示</button>
</div>

<div id="certificate" style="display:none;">
  <canvas id="certificateCanvas" width="800" height="600"></canvas><br>
</div>

<script>
const quizzes = [
  { number: 1, question: "万博の中央にある、自然豊かなゾーンの名前は？", choices: ["静かな林","静寂の公園","静けさの森"], answer: "静けさの森", img: null },
  { number: 2, question: "この画像のパビリオンはどこでしょう？", choices: ["コモンズB館","コモンズC館","コモンズD館"], answer: "コモンズB館", img: "images/q2.png" },
  { number: 3, question: "「２億円トイレ」で有名なトイレ５で使われていない色は何でしょう？", choices: ["オレンジ","黄色","緑"], answer: "緑", img: null },
  { number: 4, question: "この画像のパビリオンはどれでしょう？", choices: ["関西パビリオン","EXPO ホール「シャインハット」","三菱未来館"], answer: "EXPO ホール「シャインハット」", img: "images/q4.png" },
  { number: 5, question: "⑤にあるお寿司屋さんは何でしょう？", choices: ["くら寿司","スシロー","大起水産"], answer: "くら寿司", img: null },
];

let currentIndex = 0;
let answers = Array(quizzes.length).fill(null);
let selectedOption = null;
let selectedIcon = null;

// クイズ表示
function displayQuestion() {
  const q = quizzes[currentIndex];
  document.getElementById("questionNumber").innerText = `問題${q.number}`;
  document.getElementById("questionText").innerText = q.question;

  const imgEl = document.getElementById("questionImg");
  if(q.img){ imgEl.src = q.img; imgEl.style.display="block"; } else { imgEl.style.display="none"; }

  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = "";
  selectedOption = answers[currentIndex] !== null ? answers[currentIndex] : null;

  q.choices.forEach(c => {
    const btn = document.createElement("button");
    btn.innerText = c;
    btn.className = "choiceBtn";
    if(answers[currentIndex] !== null){
      btn.classList.add("disabled");
      if(c === answers[currentIndex]) btn.classList.add("selected");
    }
    btn.onclick = () => { selectOption(btn, c); };
    choicesDiv.appendChild(btn);
  });

  const confirmBtn = document.getElementById("confirmBtn");
  confirmBtn.disabled = answers[currentIndex] !== null || selectedOption === null;

  // 左右ボタン表示制御
  document.getElementById("prevBtn").style.display = currentIndex === 0 ? "none" : "inline-block";
  document.getElementById("nextBtn").style.display = currentIndex === quizzes.length-1 ? "none" : "inline-block";

  document.getElementById("quizResult").innerText = answers[currentIndex] !== null ? 
    (answers[currentIndex]===q.answer ? "正解！" : "不正解") : "";
}

// 選択肢選択
function selectOption(btn, choice){
  if(answers[currentIndex] !== null) return;
  selectedOption = choice;
  document.querySelectorAll(".choiceBtn").forEach(b=>b.classList.remove("selected"));
  btn.classList.add("selected");
  document.getElementById("confirmBtn").disabled = false;
}

// 決定ボタン
function confirmAnswer(){
  if(selectedOption === null) return;
  answers[currentIndex] = selectedOption;
  document.querySelectorAll(".choiceBtn").forEach(b=>b.classList.add("disabled"));
  const q = quizzes[currentIndex];
  if(selectedOption === q.answer){
    document.getElementById("quizResult").innerText = "正解！";
  } else {
    document.getElementById("quizResult").innerText = `不正解！ 正解は「${q.answer}」です`;
  }

  // 最後の問題から1秒待って名前入力画面
  if(currentIndex === quizzes.length-1){
    setTimeout(()=>{
      const correctCount = answers.filter((a,i)=>a===quizzes[i].answer).length;
      document.getElementById("nameInputTitle").innerText = `あなたは${quizzes.length}問中${correctCount}問正解しました`;
      document.getElementById("quizContainer").style.display="none";
      document.getElementById("nameInput").style.display="block";
    }, 1000); // 1秒後
  }
}

// 前後ボタン
function prevQuestion(){ if(currentIndex>0){ currentIndex--; displayQuestion(); } }
function nextQuestion(){ if(currentIndex<quizzes.length-1){ currentIndex++; displayQuestion(); } }

// アイコン選択
function selectIcon(imgEl){
  document.querySelectorAll(".iconOption").forEach(i=>i.classList.remove("selected"));
  imgEl.classList.add("selected");
  selectedIcon = imgEl.src;
}

// 賞状生成
function generateCertificate(){
  const name = document.getElementById("userNameField").value.trim();
  if(!name){ alert("名前を入力してください"); return; }
  if(!selectedIcon){ alert("アイコンを選択してください"); return; }

  const correctAnswers = answers.filter((a,i)=>a===quizzes[i].answer).length;

  document.getElementById("nameInput").style.display="none";
  document.getElementById("certificate").style.display="block";

  const canvas = document.getElementById("certificateCanvas");
  const ctx = canvas.getContext("2d");

  const bg = new Image();
  bg.src = (correctAnswers === quizzes.length) ? "images/fullscore.png" : "images/participation.png";

  bg.onload = () => {
    ctx.drawImage(bg,0,0,canvas.width,canvas.height);

    const iconImg = new Image();
    iconImg.src = selectedIcon;
    iconImg.onload = ()=>{
      ctx.drawImage(iconImg, 325, 320, 150, 150);

      // 名前表示
      ctx.font = "36px 'Kosugi Maru'";
      ctx.textAlign = "center";

      // グラデーションで金色風
      let gradientName = ctx.createLinearGradient(0, 0, 0, 100);
      gradientName.addColorStop(0, "#FFD700");
      gradientName.addColorStop(1, "#B8860B");
      ctx.fillStyle = gradientName;

      ctx.fillText(name, canvas.width/2, 275);

      // 日付表示
      const today = new Date();
      const dateStr = today.getFullYear() + "年" +
                     (today.getMonth()+1) + "月" +
                     today.getDate() + "日";
      ctx.font = "24px 'Kosugi Maru'";
      let gradientDate = ctx.createLinearGradient(0, 0, 0, 50);
      gradientDate.addColorStop(0, "#FFD700");
      gradientDate.addColorStop(1, "#B8860B");
      ctx.fillStyle = gradientDate;

      ctx.fillText(dateStr, canvas.width/2, canvas.height - 80);
    };
  };
}

// 初期表示
displayQuestion();
</script>

</body>
</html>

